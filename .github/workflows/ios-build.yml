name: Build Vita3K for iOS

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: macos-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Xcode
        run: sudo xcode-select -s /Applications/Xcode_14.2.app

      - name: Install dependencies
        run: brew install cmake ninja python3

      - name: Configure and build
        run: |
          mkdir build-ios
          cd build-ios
          cmake .. -G Ninja -DCMAKE_SYSTEM_NAME=iOS -DCMAKE_OSX_ARCHITECTURES=arm64 -DCMAKE_OSX_DEPLOYMENT_TARGET=13.0
          ninja

      - name: Package .ipa
        run: |
          mkdir Payload
          cp -R build-ios/Vita3K.app Payload/
          zip -r Vita3K.ipa Payload
        if: success()
